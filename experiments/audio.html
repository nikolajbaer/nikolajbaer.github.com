<html>
<head>
    <style type="text/css">
    body{
        background-color: #000;
        padding: 0px; margin: 0px;
        width: 100%;
        height: 100%;
    }
    #rec {
        width: 100px;
        height: 100px;
        border-radius: 50px;
        background-color: #ee0000;
        position: absolute;
        top: 50%;
        left: 50%; 
    }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>

var context=null;
var instream=null;
var vis_node = null;

function attachStream(stream){
    instream = stream;
    run(instream);
}

function run(stream){
    if(context==null){
        console.log("no context, aborting");
        return;
    }

    if(vis_node == null){
        vis_node = context.createAnalyser();
    }

    var src = context.createMediaStreamSource(stream);
    src.connect( vis_node );

}

function init(){
  try {
    // Fix up for prefixing
    window.AudioContext = window.AudioContext||window.webkitAudioContext;
    context = new AudioContext();
  }
  catch(e) {
    alert('Web Audio API is not supported in this browser');
  } 
    
}

function start_record(){
    if(instream==null){
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
        navigator.getUserMedia( {audio:true}, attachStream );
    }else{
        run(instream);
    } 
}

function end_record(){
}

$(document).ready(function(){
    init();    
    $("#rec").click(start_record);
});

    </script>
</head>
<body>
    <div id="rec"></div>
</body>
</html>
