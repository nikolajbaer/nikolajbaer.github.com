<html>
<head>
    <style type="text/css">
        body{
            padding: 0px;
            margin: 0px;
            width: 100%;
            height: 100%;
        }
        #thecanvas{
            margin:auto;
            border: 1px solid black;
        }
    </style>
    <script type="text/javascript">
        var root;
        var current;
        var canvas;
        var ctx;
        var max_height=0;

        var Node = function(data){
            this.left=null;
            this.right=null;
            this.data=data;
        }

        Node.prototype.get_height = function(){
            var l = this.left?this.left.get_height():0; 
            var r = this.right?this.right.get_height():0; 
            var h = 1+Math.max(l,r); 
            // ugly global to assist in drawing tree nicely
            if(h>max_height){ max_height=h; }
            return h;
        }

        Node.prototype.get_balance = function(){
            var l = this.left?this.left.get_height():0; 
            var r = this.right?this.right.get_height():0; 
            return l-r;
        }

        Node.prototype.balance = function(){
            console.log("Node "+this.data+" - height="+this.get_height()+", balance="+this.get_balance()); 
            var b = this.get_balance();
            var h = this.get_height();
        }

        Node.prototype.insert = function(data){
            //current = this; // if the pause and draw worked..
            if(data<this.data){
                if(this.left != null){
                    this.left.insert(data);
                }else{
                    this.left=new Node(data);
                }
            }else{
                if(this.right != null){
                    this.right.insert(data);
                }else{
                    this.right=new Node(data);
                }
            }
            pause_and_draw();
            this.balance(); 
        }

        Node.prototype.delete_child = function(data){
            // TBI
        }

        function build_tree(n){
            root = new Node(Math.round(Math.random()*100));
            for(var i=0;i<n;i++){
                root.insert(Math.round(Math.random()*100)); 
            }
        }


        /* Drawing/Rendering Stuff*/
        function pause_and_draw(){
           // TODO draw and sleep for like 1 second? i guess we can't really sleep in js
           // maybe queue up commands?
        }  

        function onload(e){
            //stretch canvas
            canvas = document.getElementById("thecanvas");
            //canvas.style.width=window.innerWidth+"px";
            //canvas.style.height=window.innerHeight+"px";
            ctx = canvas.getContext("2d");
            ctx.translate(window.innerWidth/4,20); // middle of the top with some padding

            console.log("building tree");
            build_tree(20);
            draw(root,0,0,0);
        } 

        function draw(node,depth,x,y){
            ctx.strokeStyle = "rgba(0,0,0,0.3)";
            ctx.fillStyle = "rgba(0,0,0,1)";
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(0,0);
            ctx.lineTo(x,y);
            ctx.closePath();
            ctx.stroke();
            ctx.translate(x,y);
            ctx.fillStyle=node==current?"rgba(0,0,255,0.5)":"rgba(255,0,0,0.5)";
            ctx.beginPath();
            ctx.arc(0,0,node.data/100*20,0,Math.PI*2,true); // circle
            ctx.closePath();
            ctx.font = "8pt Arial";
            ctx.fill()
            ctx.fillStyle="Black";
            ctx.fillText(node.data, 0, 0);  
            var pxw = 30-depth*10; //(1-depth/max_height)*(max_height*15);
            var pxh = 60-depth*5; //(depth/max_height) * (max_height*15);
            if(node.left!=null){
                draw(node.left,depth+1,-pxw,pxh);   
            }
            if(node.right!=null){
                draw(node.right,depth+1,pxw,pxh);   
            }
            ctx.restore();
        }

        document.addEventListener("DOMContentLoaded", onload, false);
    </script>
</head>
<body>
    <canvas width="800px" height="600px" style="margin: auto;" id="thecanvas" />
</body>
</html>
