<html>
  <head>
    <style type="text/css">
        body {margin: 0px; padding: 0px; width: 100%; height: 100%; }
    </style>
  </head>
  <body>
    <div id="game"></div>
    <script type="text/javascript" src="js/crafty.js"></script>

    <script>
        var width = window.innerWidth;
        var height = window.innerHeight;

        Crafty.init(width,height, document.getElementById('game'));

        // Generate the breakout bricks
        var W = 13;
        var ROWS = 3;
        var BW = width/W;
        for(var i=0;i<W*ROWS;i++){
            Crafty.e('Brick, 2D, DOM,  Color')
                .color(i%2?'red':'blue')
                .attr({x:(i%W)*BW+1,y:Math.floor(i/W)*BW+1,w:BW-2,h:BW-2})
        }

        Crafty.c('Ball',{
            init: function() {
                this.requires('2D, DOM, Color, Collision');
                this.attr({w: 10, h: 10});
                this.color('green');
                this.onHit('Brick',function(bricks){
                    console.log(bricks);
                    for(var b=0;b<bricks.length;b++){
                        bricks[b].obj.destroy();
                    }
                    this.dY *= -1;
                });
                this.onHit('Paddle',function(paddles){
                    var p = paddles[0].obj;
                    this.dX += p.v/4;
                    this.dY *= -1;
                });
                this.bind('EnterFrame',function(){
                    this.x += this.dX;
                    this.y += this.dY;
                    if(this.x < 0){ this.dX *= -1; }
                    if(this.y < 0){
                        this.destroy();
                        Crafty.trigger("Point");
                    }
                    if(this.y > Crafty.viewport.height){
                        this.destroy();
                        Crafty.trigger("Miss");
                    }
                    if(this.x > Crafty.viewport.width){
                        this.dX *= -1;
                    }
                });
            },
            launch:function(x,y){
                this.attr({x:x,y:y-this.h,dX:0,dY:-5});
            } 
        }); 

        Crafty.e('Paddle, 2D, DOM, Color, Keyboard, Mouse')
          .attr({x: width/2, y: height-BW/4, w: BW*2, h: BW/2,v:0})
          .color('#F00')
          .bind('updateStats',function(e){
            console.log("mouse move",e);
            this.mouseRealX = e.realX;
          })
          .bind('EnterFrame',function(){
            if(this.isDown('LEFT_ARROW')){ this.v += -3; }
            else if(this.isDown('RIGHT_ARROW')){ this.v += 3; }

                 

            this.x += this.v; //this.mouseRealX; 
            
            if(this.isDown('SPACE')){
                if(Crafty('Ball').length == 0){
                    Crafty.e('Ball')
                        .launch(this.x+this.w/2,this.y-this.h/2)
                }
            }
          });

    </script>
  </body>
</html>


